{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jonathan/Desktop/flashcard/app/api/translate/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport path from 'path';\r\nimport { promises as fs } from 'fs';\r\nimport { translate } from '@vitalets/google-translate-api';\r\nimport { HttpProxyAgent } from 'http-proxy-agent';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\n// =================================================================\r\n// Szolg√°ltat√≥i F√ºggv√©nyek\r\n// =================================================================\r\n\r\n// 1. SZOLG√ÅLTAT√ì: Helyi Mini-Sz√≥t√°r\r\nlet miniDictionary = null;\r\nasync function getFromLocalDictionary(word) {\r\n  try {\r\n    if (miniDictionary === null) {\r\n      const jsonPath = path.join(process.cwd(), 'public', 'data', 'mini_dictionary.json');\r\n      const jsonData = await fs.readFile(jsonPath, 'utf-8');\r\n      miniDictionary = JSON.parse(jsonData);\r\n    }\r\n    const result = miniDictionary[word.toLowerCase()];\r\n    return result || [];\r\n  } catch (error) {\r\n    console.error(`‚ùå Hiba a helyi sz√≥t√°r olvas√°sakor: ${error.message}`);\r\n    miniDictionary = {};\r\n    return [];\r\n  }\r\n}\r\n\r\n// 2. SZOLG√ÅLTAT√ì: Google Translate Proxy Rot√°torral\r\nconst proxies = (process.env.PROXY_LIST || '').split(',').filter(Boolean);\r\nasync function getGoogleTranslateWithProxy(word) {\r\n  if (proxies.length === 0) {\r\n      console.warn('‚ö†Ô∏è Nincs proxy be√°ll√≠tva a PROXY_LIST v√°ltoz√≥ban. A h√≠v√°s proxy n√©lk√ºl t√∂rt√©nik.');\r\n  }\r\n\r\n  // Pr√≥b√°lkozzunk maximum 3 k√ºl√∂nb√∂z≈ë proxyval, ha hiba t√∂rt√©nik\r\n  const maxRetries = Math.min(proxies.length, 3) || 1; \r\n\r\n  for (let attempt = 0; attempt < maxRetries; attempt++) {\r\n    try {\r\n      let agent;\r\n      if (proxies.length > 0) {\r\n        const randomProxy = proxies[Math.floor(Math.random() * proxies.length)];\r\n        console.log(`üì° Pr√≥b√°lkoz√°s a k√∂vetkez≈ë proxyval: ${randomProxy.split('@')[1]}`); // Ne logoljuk a jelsz√≥t!\r\n        agent = new HttpProxyAgent(randomProxy);\r\n      }\r\n\r\n      const { text } = await translate(word, {\r\n        to: 'hu',\r\n        fetchOptions: { agent },\r\n      });\r\n\r\n      return text.split(',').map(m => m.trim().toLowerCase()).filter(Boolean);\r\n    \r\n    } catch (e) {\r\n      console.warn(`‚ö†Ô∏è Google Translate hiba a(z) ${attempt + 1}. pr√≥b√°lkoz√°sn√°l: ${e.message}`);\r\n      if (e.name !== 'TooManyRequestsError' && attempt === maxRetries - 1) {\r\n        // Ha nem rate limit hiba, √©s ez az utols√≥ pr√≥b√°lkoz√°s, akkor adjuk fel\r\n        return [];\r\n      }\r\n      // Ha rate limit hiba, vagy van m√©g pr√≥b√°lkoz√°s, a ciklus folytat√≥dik egy √∫j proxyval\r\n    }\r\n  }\r\n\r\n  // Ha minden pr√≥b√°lkoz√°s sikertelen volt\r\n  return [];\r\n}\r\n\r\n\r\n// 3. SZOLG√ÅLTAT√ì: Dictionary (V√©gs≈ë tartal√©k)\r\nasync function getDictionaryDefinitions(word) {\r\n  try {\r\n    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);\r\n    if (!response.ok) return [];\r\n    const data = await response.json();\r\n    const definition = data[0]?.meanings?.[0]?.definitions?.[0]?.definition;\r\n    return definition ? [`(def.) ${definition}`] : [];\r\n  } catch (error) {\r\n    console.warn(`‚ö†Ô∏è Dictionary API hiba: ${error.message}`);\r\n    return [];\r\n  }\r\n}\r\n\r\n// =================================================================\r\n// F≈ë API Logika\r\n// =================================================================\r\nexport async function GET(request) {\r\n  const { searchParams } = new URL(request.url);\r\n  const word = searchParams.get('word');\r\n\r\n  if (!word) {\r\n    return NextResponse.json({ error: 'A \"word\" param√©ter k√∂telez≈ë.' }, { status: 400 });\r\n  }\r\n\r\n  let finalMeanings = [];\r\n\r\n  // 1. L√âP√âS: Helyi sz√≥t√°r\r\n  const localResults = await getFromLocalDictionary(word);\r\n  if (localResults.length > 0) {\r\n    finalMeanings.push(...localResults);\r\n  }\r\n\r\n  // 2. L√âP√âS: Google Translate Proxy-val\r\n  if (finalMeanings.length === 0) {\r\n    const googleResults = await getGoogleTranslateWithProxy(word);\r\n    if (googleResults.length > 0) {\r\n      finalMeanings.push(...googleResults);\r\n    }\r\n  }\r\n  \r\n  // 3. L√âP√âS: V√©gs≈ë tartal√©k\r\n  if (finalMeanings.length === 0) {\r\n    const definitions = await getDictionaryDefinitions(word);\r\n    finalMeanings.push(...definitions);\r\n  }\r\n  \r\n  if (finalMeanings.length === 0) {\r\n    return NextResponse.json({ translation: [\"Nincs el√©rhet≈ë ford√≠t√°s\"] });\r\n  }\r\n\r\n  return NextResponse.json({ translation: finalMeanings });\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,MAAM,UAAU;AAEvB,oEAAoE;AACpE,0BAA0B;AAC1B,oEAAoE;AAEpE,oCAAoC;AACpC,IAAI,iBAAiB;AACrB,eAAe,uBAAuB,IAAI;IACxC,IAAI;QACF,IAAI,mBAAmB,MAAM;YAC3B,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,QAAQ;YAC5D,MAAM,WAAW,MAAM,yGAAE,CAAC,QAAQ,CAAC,UAAU;YAC7C,iBAAiB,KAAK,KAAK,CAAC;QAC9B;QACA,MAAM,SAAS,cAAc,CAAC,KAAK,WAAW,GAAG;QACjD,OAAO,UAAU,EAAE;IACrB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,mCAAmC,EAAE,MAAM,OAAO,EAAE;QACnE,iBAAiB,CAAC;QAClB,OAAO,EAAE;IACX;AACF;AAEA,oDAAoD;AACpD,MAAM,UAAU,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI,EAAE,EAAE,KAAK,CAAC,KAAK,MAAM,CAAC;AACjE,eAAe,4BAA4B,IAAI;IAC7C,IAAI,QAAQ,MAAM,KAAK,GAAG;QACtB,QAAQ,IAAI,CAAC;IACjB;IAEA,+DAA+D;IAC/D,MAAM,aAAa,KAAK,GAAG,CAAC,QAAQ,MAAM,EAAE,MAAM;IAElD,IAAK,IAAI,UAAU,GAAG,UAAU,YAAY,UAAW;QACrD,IAAI;YACF,IAAI;YACJ,IAAI,QAAQ,MAAM,GAAG,GAAG;gBACtB,MAAM,cAAc,OAAO,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,QAAQ,MAAM,EAAE;gBACvE,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,YAAY,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG,yBAAyB;gBAC3G,QAAQ,IAAI,2KAAc,CAAC;YAC7B;YAEA,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,+LAAS,EAAC,MAAM;gBACrC,IAAI;gBACJ,cAAc;oBAAE;gBAAM;YACxB;YAEA,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,GAAG,WAAW,IAAI,MAAM,CAAC;QAEjE,EAAE,OAAO,GAAG;YACV,QAAQ,IAAI,CAAC,CAAC,8BAA8B,EAAE,UAAU,EAAE,kBAAkB,EAAE,EAAE,OAAO,EAAE;YACzF,IAAI,EAAE,IAAI,KAAK,0BAA0B,YAAY,aAAa,GAAG;gBACnE,uEAAuE;gBACvE,OAAO,EAAE;YACX;QACA,qFAAqF;QACvF;IACF;IAEA,wCAAwC;IACxC,OAAO,EAAE;AACX;AAGA,8CAA8C;AAC9C,eAAe,yBAAyB,IAAI;IAC1C,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,CAAC,gDAAgD,EAAE,mBAAmB,OAAO;QAC1G,IAAI,CAAC,SAAS,EAAE,EAAE,OAAO,EAAE;QAC3B,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,aAAa,IAAI,CAAC,EAAE,EAAE,UAAU,CAAC,EAAE,EAAE,aAAa,CAAC,EAAE,EAAE;QAC7D,OAAO,aAAa;YAAC,CAAC,OAAO,EAAE,YAAY;SAAC,GAAG,EAAE;IACnD,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,CAAC,wBAAwB,EAAE,MAAM,OAAO,EAAE;QACvD,OAAO,EAAE;IACX;AACF;AAKO,eAAe,IAAI,OAAO;IAC/B,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAE9B,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;IAEA,IAAI,gBAAgB,EAAE;IAEtB,yBAAyB;IACzB,MAAM,eAAe,MAAM,uBAAuB;IAClD,IAAI,aAAa,MAAM,GAAG,GAAG;QAC3B,cAAc,IAAI,IAAI;IACxB;IAEA,uCAAuC;IACvC,IAAI,cAAc,MAAM,KAAK,GAAG;QAC9B,MAAM,gBAAgB,MAAM,4BAA4B;QACxD,IAAI,cAAc,MAAM,GAAG,GAAG;YAC5B,cAAc,IAAI,IAAI;QACxB;IACF;IAEA,2BAA2B;IAC3B,IAAI,cAAc,MAAM,KAAK,GAAG;QAC9B,MAAM,cAAc,MAAM,yBAAyB;QACnD,cAAc,IAAI,IAAI;IACxB;IAEA,IAAI,cAAc,MAAM,KAAK,GAAG;QAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,aAAa;gBAAC;aAA0B;QAAC;IACtE;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,aAAa;IAAc;AACxD","debugId":null}}]
}